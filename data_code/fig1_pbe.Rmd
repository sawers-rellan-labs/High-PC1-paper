---
title: "PBE analysis"
output: html_document
---
```{r}

library(tidyverse)
library(data.table)
library(cowplot)
library(wesanderson)

mex<-fread("data/fig_1/MexHigh.allPBE.txt",header=T) %>% mutate(POP="MH",POS=POS/1E6)
gua<-fread("data/fig_1/GuaHigh.allPBE.txt",header=T) %>% mutate(POP="GH",POS=POS/1E6)
and<-fread("data/fig_1/Andes.allPBE.txt",header=T) %>% mutate(POP="AN",POS=POS/1E6)
swu<-fread("data/fig_1/SW_US.allPBE.txt",header=T) %>% mutate(POP="US",POS=POS/1E6)
all_pops_pbe<-rbind(swu,mex,gua,and) %>% mutate(POP=factor(POP,levels=c("US","MH","GH","AN")))

#GRMZM2G353444(Chr3:8.442106..8.444078)
gswu<-filter(all_pops_pbe,CHROM==3,POS>8.5 ,POS<8.6,POP=="US") %>%
  ggplot(aes(y=PBE0,x=POS))+
  geom_point(size=2, alpha = 0.8) +
  ylim(-0.5,1.5) +
  xlim(8.5, 8.6) +
  theme_cowplot()+
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=8.542, xmax=8.544, ymin=-Inf, ymax=Inf,alpha=0.2,fill="grey")  

gmex<-filter(all_pops_pbe,CHROM==3,POS>8.5 ,POS<8.6,POP=="MH") %>%
  ggplot(aes(y=PBE0,x=POS))+  
  ylim(-0.5,1.5) +
  xlim(8.5, 8.6) +
  theme_cowplot()+
  geom_point(size=2, alpha = 0.8) +
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=8.542, xmax=8.544, ymin=-Inf, ymax=Inf,alpha=0.2,fill="grey")  

ggua<-filter(all_pops_pbe,CHROM==3,POS>8.5 ,POS<8.6,POP=="GH") %>%
  ggplot(aes(y=PBE0,x=POS)) +
  ylim(-0.5,1.5) +
  xlim(8.5, 8.6) +
  theme_cowplot()+
  geom_point(size=2, alpha = 0.8)+
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=8.542, xmax=8.544, ymin=-Inf, ymax=Inf,alpha=0.2,fill="grey")  


gand<-filter(all_pops_pbe,CHROM==3,POS>8.5 ,POS<8.6,POP=="AN") %>%
  ggplot(aes(y=PBE0,x=POS)) +
  geom_point(size=2, alpha = 0.8) +
  ylim(-0.5,1.5) +
  xlim(8.5, 8.6) +
  theme_cowplot()+
  #theme(axis.text.x=element_text(size=15),axis.title.x = element_text(size=16))+
  xlab("Position (Mb)")+
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=8.542, xmax=8.544, ymin=-Inf, ymax=Inf,alpha=0.5,fill="grey")  

bob=filter(all_pops_pbe,CHROM==3,POS>8.4 ,POS<8.6) %>% 
  ggplot(aes(y=PBE0,x=POS,color=POP))+geom_point(size=2)+ theme(legend.position="bottom")+
  scale_color_manual(values=c(wes_palette("Darjeeling1")[c(3,1)], wes_palette("Royal2")[3], "purple"),name="Populations:")

#legend <- get_legend(bob)
plot_grid(gswu,gmex,ggua,gand,ncol=1)
#plot_grid(legend,pgrid,  ncol = 1, rel_heights = c(.1, 1))
ggsave("GRMZM2G353444.pdf")


#GRMZM2G481755(Chr5:195495289..195505503)

gswu_lpcat <-filter(x,CHROM==5,POS>195.4,POS<195.6,POP=="US") %>%
  ggplot(aes(y=PBE0,x=POS))+
  geom_point(size=2, alpha = 0.8) +
  ylim(-0.5,1.5) +
  xlim(195.45, 195.55) +
  theme_cowplot() +
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=195.495, xmax=195.506, ymin=-Inf, ymax=Inf,alpha=0.5,fill="grey")  

gmex_lpcat <-filter(x,CHROM==5,POS>195.4,POS<195.6,POP=="MH") %>%
  ggplot(aes(y=PBE0,x=POS))+  
  ylim(-0.5,1.5) +
  xlim(195.45, 195.55) +
  theme_cowplot()+
  geom_point(size=2, alpha = 0.8) +
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=195.495, xmax=195.506, ymin=-Inf, ymax=Inf,alpha=0.5,fill="grey")  

ggua_lpcat <-filter(x,CHROM==5,POS>195.4,POS<195.6,POP=="GH") %>%
  ggplot(aes(y=PBE0,x=POS))+
  ylim(-0.5,1.5) + 
  xlim(195.45, 195.55) +
  theme_cowplot()+
  geom_point(size=2, alpha = 0.8) +
  geom_hline(yintercept=0.4, color="red", linetype="dashed")+
  annotate("rect",xmin=195.495, xmax=195.506, ymin=-Inf, ymax=Inf,alpha=0.5,fill="grey")  


gand_lpcat <-filter(x,CHROM==5,POS>195.4,POS<195.6,POP=="AN") %>%
  ggplot(aes(y=PBE0,x=POS)) +
  geom_point(size=2, alpha = 0.8) +
  ylim(-0.5,1.5) +
  xlim(195.45, 195.55) +
  theme_cowplot() +
  #theme(axis.text.x=element_text(size=15),axis.title.x = element_text(size=16)) +
  xlab("Position (Mb)") +
  geom_hline(yintercept=0.4, color="red", linetype="dashed") +
  annotate("rect",xmin=195.495, xmax=195.506, ymin=-Inf, ymax=Inf,alpha=0.5,fill="grey")  

bob=filter(x,CHROM==5,POS>195.4,POS<195.6) %>% 
  ggplot(aes(y=PBE0,x=POS,color=POP))+geom_point(size=2)+ theme(legend.position="bottom")+
  scale_color_manual(values=c(wes_palette("Darjeeling1")[c(3,1)], wes_palette("Royal2")[3], "purple"),name="Populations:")

#legend <- get_legend(bob)
plot_grid(gswu, gswu_lpcat, gmex, gmex_lpcat, ggua, ggua_lpcat, gand, gand_lpcat, ncol = 2)
#plot_grid(legend,pgrid,  ncol = 1, rel_heights = c(.1, 1))
ggsave("GRMZM2G481755.pdf")

```
